# üåç Best Practices –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —è–∑—ã–∫–∞ –≤ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

## üìã –û–±–∑–æ—Ä —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

–í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã **best practices** –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —è–∑—ã–∫–∞:

### 1. **URL-based –ø–æ–¥—Ö–æ–¥** (SEO-friendly)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ URL**: `/{lang}/{page}` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `/ru/about`, `/en/contacts`)
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: `LanguageMiddleware` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —è–∑—ã–∫ –∏–∑ URL

### 2. **Cookie-based –ø–æ–¥—Ö–æ–¥** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è)
- **Cookie**: `user_language` —Å TTL 1 –≥–æ–¥
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —è–∑—ã–∫–∞

### 3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞**
```
URL > Cookie > Default Language
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Middleware –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞
```python
# app/site/middleware.py
class LanguageMiddleware(BaseHTTPMiddleware):
    async def dispatch(self, request: Request, call_next: Callable) -> Response:
        # 1. –ò–∑–≤–ª–µ–∫–∞–µ–º —è–∑—ã–∫ –∏–∑ URL
        language_from_url = self.extract_language_from_url(request.url.path)
        
        # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º cookie —Å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        language_from_cookie = request.cookies.get("user_language")
        
        # 3. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: URL > Cookie > Default
        if language_from_url != self.default_language:
            language = language_from_url
        elif language_from_cookie and is_language_supported(language_from_cookie):
            language = language_from_cookie
        else:
            language = self.default_language
```

### JavaScript –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–æ–≤
```javascript
// app/static/js/language.js
function switchLanguage(language) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º API endpoint –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ cookie
    fetch('/api/set-language', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `language=${language}`
    })
    .then(response => {
        if (response.ok) {
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –Ω–æ–≤—É—é —è–∑—ã–∫–æ–≤—É—é –≤–µ—Ä—Å–∏—é
            const newUrl = `/${language}${getCleanPath(window.location.pathname)}`;
            window.location.href = newUrl;
        }
    });
}
```

### API endpoint –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
```python
# app/site/routes.py
@router.post("/api/set-language")
async def set_language_api(request: Request, language: str):
    """API endpoint –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞"""
    if not is_language_supported(language):
        raise HTTPException(status_code=400, detail=f"Language '{language}' is not supported")
    
    response = Response(content={"success": True, "language": language})
    set_language_cookie(response, language)
    return response
```

## üéØ Best Practices

### 1. **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞**
- **URL** –∏–º–µ–µ—Ç –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–¥–ª—è SEO –∏ –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫)
- **Cookie** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- **Default** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback

### 2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å cookie**
```python
response.set_cookie(
    key="user_language",
    value=language,
    max_age=365*24*60*60,  # 1 –≥–æ–¥
    httponly=False,  # –î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è JavaScript
    samesite="lax",  # –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
    secure=False  # –î–ª—è development
)
```

### 3. **–í–∞–ª–∏–¥–∞—Ü–∏—è —è–∑—ã–∫–æ–≤**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —è–∑—ã–∫–æ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —è–∑—ã–∫–æ–≤ (fallback –Ω–∞ default)
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

### 4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —è–∑—ã–∫–∞–º**
- –û—Ç–¥–µ–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ—Ç–µ—Å—Ç cookie-based —Ö—Ä–∞–Ω–µ–Ω–∏—è
```bash
python manage_tests.py language_cookie
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫—É cookie –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —è–∑—ã–∫–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç URL –Ω–∞–¥ cookie
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —è–∑—ã–∫–æ–≤
- ‚úÖ –†–∞–±–æ—Ç—É —Å CMS –∏ –ø—É–±–ª–∏—á–Ω—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Cookie
```
user_language=ru; max-age=31536000; path=/; samesite=lax
```

### URL —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
/ru/about     - –†—É—Å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–û –∫–æ–º–ø–∞–Ω–∏–∏"
/en/contacts  - –ê–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ö–æ–Ω—Ç–∞–∫—Ç—ã"
/ua/catalog   - –£–∫—Ä–∞–∏–Ω—Å–∫–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ö–∞—Ç–∞–ª–æ–≥"
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —è–∑—ã–∫–æ–≤
```python
# app/site/config.py
SUPPORTED_LANGUAGES = ["en", "ua", "ru"]
DEFAULT_LANGUAGE = "en"
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í —à–∞–±–ª–æ–Ω–∞—Ö
```html
<!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤ -->
<button onclick="switchLanguage('ru')" data-language-button="ru">
    RU
</button>
<button onclick="switchLanguage('en')" data-language-button="en">
    EN
</button>
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
```javascript
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —É–∫—Ä–∞–∏–Ω—Å–∫–∏–π —è–∑—ã–∫
switchLanguage('ua');
```

### API –≤—ã–∑–æ–≤
```javascript
// –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ API
fetch('/api/set-language', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: 'language=ru'
});
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —è–∑—ã–∫–æ–≤
2. **CSRF –∑–∞—â–∏—Ç–∞** - SameSite cookie policy
3. **XSS –∑–∞—â–∏—Ç–∞** - —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
4. **Path traversal –∑–∞—â–∏—Ç–∞** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π URL

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞
2. **Middleware –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
3. **JavaScript fallback** - —Ä–∞–±–æ—Ç–∞ –±–µ–∑ JavaScript
4. **CDN —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - URL-based –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏ —Å:
- ‚úÖ SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ URL
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —è–∑—ã–∫–æ–≤
- ‚úÖ –í—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–æ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
