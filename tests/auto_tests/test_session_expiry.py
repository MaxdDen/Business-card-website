#!/usr/bin/env python3
"""
–ê–≤—Ç–æ—Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ JWT —Ç–æ–∫–µ–Ω–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º
- –ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
- JavaScript –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Å—Å–∏–∏
"""

import requests
import time
import json
import os
import sys
from datetime import datetime, timezone, timedelta

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))

def test_session_expiry_functionality():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏...")
    
    base_url = "http://localhost:8000"
    session = requests.Session()
    
    try:
        # 1. –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∫ CMS –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        print("1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ CMS –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        response = session.get(f"{base_url}/en/cms/")
        assert response.status_code == 302, f"–û–∂–∏–¥–∞–ª—Å—è —Ä–µ–¥–∏—Ä–µ–∫—Ç 302, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        assert "/login" in response.headers.get("location", ""), "–†–µ–¥–∏—Ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞"
        print("‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
        
        # 2. –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ URL –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ next
        print("2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è URL –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ next...")
        cms_url = f"{base_url}/en/cms/texts"
        response = session.get(cms_url)
        assert response.status_code == 302, f"–û–∂–∏–¥–∞–ª—Å—è —Ä–µ–¥–∏—Ä–µ–∫—Ç 302, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        location = response.headers.get("location", "")
        assert "next=" in location, "URL –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä next"
        assert "cms/texts" in location, "–ü–∞—Ä–∞–º–µ—Ç—Ä next –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π URL"
        print("‚úÖ URL —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ next")
        
        # 3. –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–Ω —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º next
        print("3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–Ω–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º next...")
        
        # –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º next
        login_url = f"{base_url}/en/login?next=/en/cms/texts"
        response = session.get(login_url)
        assert response.status_code == 200, f"–û–∂–∏–¥–∞–ª—Å—è —Å—Ç–∞—Ç—É—Å 200, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        assert "next" in response.text, "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ next"
        print("‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä next")
        
        # 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º API endpoints –¥–ª—è —Å–µ—Å—Å–∏–∏
        print("4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API endpoints –¥–ª—è —Å–µ—Å—Å–∏–∏...")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–µ—Å—Å–∏–∏ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
        response = session.get(f"{base_url}/cms/api/session-check")
        assert response.status_code == 401, f"–û–∂–∏–¥–∞–ª—Å—è —Å—Ç–∞—Ç—É—Å 401, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        print("‚úÖ API session-check –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 –±–µ–∑ —Ç–æ–∫–µ–Ω–∞")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
        response = session.post(f"{base_url}/cms/api/session-refresh")
        assert response.status_code == 401, f"–û–∂–∏–¥–∞–ª—Å—è —Å—Ç–∞—Ç—É—Å 401, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        print("‚úÖ API session-refresh –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 –±–µ–∑ —Ç–æ–∫–µ–Ω–∞")
        
        # 5. –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å –≤–∞–ª–∏–¥–Ω–æ–π —Å–µ—Å—Å–∏–µ–π
        print("5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤–∞–ª–∏–¥–Ω–æ–π —Å–µ—Å—Å–∏–µ–π...")
        
        # –õ–æ–≥–∏–Ω–∏–º—Å—è
        login_data = {
            "email": "admin@example.com",
            "password": "admin123456"
        }
        response = session.post(f"{base_url}/login", data=login_data, allow_redirects=False)
        assert response.status_code == 302, f"–û–∂–∏–¥–∞–ª—Å—è —Ä–µ–¥–∏—Ä–µ–∫—Ç 302, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏ cookie
        assert "access_token" in session.cookies, "–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω access_token cookie"
        print("‚úÖ –£—Å–ø–µ—à–Ω—ã–π –ª–æ–≥–∏–Ω —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π cookie")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–µ—Å—Å–∏–∏ —Å –≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
        response = session.get(f"{base_url}/cms/api/session-check")
        assert response.status_code == 200, f"–û–∂–∏–¥–∞–ª—Å—è —Å—Ç–∞—Ç—É—Å 200, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        
        session_data = response.json()
        assert session_data.get("valid") == True, "–°–µ—Å—Å–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω–æ–π"
        assert "expires_at" in session_data, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è"
        assert "time_until_expiry_seconds" in session_data, "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—Ä–µ–º—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è"
        print("‚úÖ API session-check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Å—Å–∏–∏")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
        response = session.post(f"{base_url}/cms/api/session-refresh")
        assert response.status_code == 200, f"–û–∂–∏–¥–∞–ª—Å—è —Å—Ç–∞—Ç—É—Å 200, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        
        refresh_data = response.json()
        assert refresh_data.get("success") == True, "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å–ø–µ—à–Ω—ã–º"
        print("‚úÖ API session-refresh —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Å—Å–∏—é")
        
        # 6. –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∫ CMS —Å –≤–∞–ª–∏–¥–Ω–æ–π —Å–µ—Å—Å–∏–µ–π
        print("6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ CMS —Å –≤–∞–ª–∏–¥–Ω–æ–π —Å–µ—Å—Å–∏–µ–π...")
        response = session.get(f"{base_url}/en/cms/")
        assert response.status_code == 200, f"–û–∂–∏–¥–∞–ª—Å—è —Å—Ç–∞—Ç—É—Å 200, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        print("‚úÖ –î–æ—Å—Ç—É–ø –∫ CMS —Å –≤–∞–ª–∏–¥–Ω–æ–π —Å–µ—Å—Å–∏–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # 7. –¢–µ—Å—Ç–∏—Ä—É–µ–º JavaScript —Ñ–∞–π–ª
        print("7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JavaScript —Ñ–∞–π–ª–∞...")
        response = session.get(f"{base_url}/static/js/session-monitor.js")
        assert response.status_code == 200, f"–û–∂–∏–¥–∞–ª—Å—è —Å—Ç–∞—Ç—É—Å 200, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        assert "SessionMonitor" in response.text, "JavaScript —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª–∞—Å—Å SessionMonitor"
        assert "checkSession" in response.text, "JavaScript —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–µ—Ç–æ–¥ checkSession"
        print("‚úÖ JavaScript —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –∫–æ–¥")
        
        # 8. –¢–µ—Å—Ç–∏—Ä—É–µ–º –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å –≤ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö
        print("8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö...")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
        response = session.get(f"{base_url}/ru/cms/")
        assert response.status_code == 302, f"–û–∂–∏–¥–∞–ª—Å—è —Ä–µ–¥–∏—Ä–µ–∫—Ç 302, –ø–æ–ª—É—á–µ–Ω {response.status_code}"
        location = response.headers.get("location", "")
        assert "/ru/login" in location, "–†–µ–¥–∏—Ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å —è–∑—ã–∫"
        print("‚úÖ –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å –≤ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!")
        return True
        
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–∞—Ö: {e}")
        return False

def test_session_expiry_edge_cases():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏"""
    print("\nüß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤...")
    
    base_url = "http://localhost:8000"
    session = requests.Session()
    
    try:
        # 1. –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã next
        print("1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ next...")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å –ø—É—Å—Ç—ã–º next
        response = session.get(f"{base_url}/login?next=")
        assert response.status_code == 200, "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å –ø—É—Å—Ç—ã–º next"
        print("‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ next —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º next
        response = session.get(f"{base_url}/login?next=invalid_url")
        assert response.status_code == 200, "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º next"
        print("‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ next —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        # 2. –¢–µ—Å—Ç–∏—Ä—É–µ–º API —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏
        print("2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏...")
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω
        session.cookies.set("access_token", "invalid_token")
        response = session.get(f"{base_url}/cms/api/session-check")
        assert response.status_code == 401, "API –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 401 –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞"
        print("‚úÖ API –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã")
        
        # 3. –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø—É—Ç–∏ CMS
        print("3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—É—Ç–µ–π CMS...")
        
        cms_paths = ["/en/cms/", "/en/cms/texts", "/en/cms/images", "/en/cms/seo", "/en/cms/users"]
        for path in cms_paths:
            response = session.get(f"{base_url}{path}")
            assert response.status_code == 302, f"–ü—É—Ç—å {path} –¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ –ª–æ–≥–∏–Ω"
            location = response.headers.get("location", "")
            assert "/login" in location, f"–†–µ–¥–∏—Ä–µ–∫—Ç –¥–ª—è {path} –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ –Ω–∞ –ª–æ–≥–∏–Ω"
        print("‚úÖ –í—Å–µ –ø—É—Ç–∏ CMS –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç—è—Ç –Ω–∞ –ª–æ–≥–∏–Ω")
        
        # 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (–Ω–µ –¥–æ–ª–∂–Ω—ã —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å)
        print("4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤...")
        
        static_paths = ["/cms/static/css/output.css", "/cms/static/js/session-monitor.js"]
        for path in static_paths:
            response = session.get(f"{base_url}{path}")
            # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 200 –∏–ª–∏ 404, –Ω–æ –Ω–µ –¥–æ–ª–∂–Ω—ã —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å
            assert response.status_code != 302, f"–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª {path} –Ω–µ –¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å"
        print("‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—è—Ç –Ω–∞ –ª–æ–≥–∏–Ω")
        
        print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!")
        return True
        
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–∞—Ö –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤: {e}")
        return False

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏")
    print("=" * 60)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
    try:
        response = requests.get("http://localhost:8000/health", timeout=5)
        if response.status_code != 200:
            print("‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:8000")
            return False
    except requests.exceptions.RequestException:
        print("‚ùå –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:8000")
        return False
    
    print("‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω")
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
    success = True
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
    if not test_session_expiry_functionality():
        success = False
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
    if not test_session_expiry_edge_cases():
        success = False
    
    if success:
        print("\nüéâ –í—Å–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!")
        print("\nüìã –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:")
        print("  ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ JWT —Ç–æ–∫–µ–Ω–∞")
        print("  ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º –Ω–∞ –ª–æ–≥–∏–Ω")
        print("  ‚úÖ –ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞")
        print("  ‚úÖ JavaScript –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Å—Å–∏–∏ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏")
        print("  ‚úÖ API endpoints –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏")
        print("  ‚úÖ –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö")
        print("  ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤")
    else:
        print("\n‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ.")
    
    return success

if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)
