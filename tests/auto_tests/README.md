# Автотесты CMS

Этот каталог содержит автотесты для проверки функциональности CMS.

## Доступные тесты

### 1. test_csrf_fix.py
**Описание:** Тест исправления CSRF проблемы  
**Что проверяет:** API endpoints работают без CSRF токенов, обычные формы защищены CSRF  
**Запуск:** `python manage_tests.py csrf`

### 2. test_images_management.py
**Описание:** Тест управления изображениями  
**Что проверяет:** Загрузка, оптимизация, удаление, сортировка изображений  
**Запуск:** `python manage_tests.py images`

### 3. test_texts_editor_fixed.py
**Описание:** Тест редактора текстов (исправленная версия)  
**Что проверяет:** Загрузка, редактирование, сохранение текстов с автоматической загрузкой  
**Запуск:** `python manage_tests.py texts`

### 4. test_seo_management.py
**Описание:** Тест SEO функциональности  
**Что проверяет:** Создание, редактирование, валидация SEO данных с предпросмотром  
**Запуск:** `python manage_tests.py seo`

### 5. test_users_management.py
**Описание:** Тест управления пользователями  
**Что проверяет:** Создание, удаление, сброс пароля пользователей с проверкой ролей  
**Запуск:** `python manage_tests.py users`

### 6. test_public_site.py
**Описание:** Тест публичного сайта  
**Что проверяет:** Публичные роуты, мультиязычность, загрузка контента из БД, SEO, кэширование  
**Запуск:** `python manage_tests.py public`

### 7. test_multilang.py
**Описание:** Тест мультиязычности  
**Что проверяет:** Автоматическое определение языка, переключение языков, генерация URL  
**Запуск:** `python manage_tests.py multilang`

### 8. test_cms_language_persistence.py
**Описание:** Тест сохранения языка в CMS  
**Что проверяет:** Сохранение языка при переходах между страницами CMS, языковые алиасы  
**Запуск:** `python manage_tests.py language_persistence`

### 9. test_security.py
**Описание:** Тест безопасности системы (Этап 12)  
**Что проверяет:** Security headers, безопасность cookies, валидацию файлов, защиту от SQL/XSS, rate limiting, валидацию паролей  
**Запуск:** `python manage_tests.py security`

### 10. test_build_scripts.py
**Описание:** Тест скриптов сборки и развертывания (Этап 13)  
**Что проверяет:** PowerShell скрипты, Makefile, NPM скрипты, README.md, файлы окружения, структуру директорий  
**Запуск:** `python manage_tests.py build`

## Новые тесты (Этап 14)

### 11. Юнит-тесты
**Описание:** Тесты отдельных компонентов системы  
**Что проверяет:** Валидация, кэширование, SQL-слой, утилиты  
**Запуск:** 
- `python manage_tests.py unit` - тесты валидации
- `python manage_tests.py unit_cache` - тесты кэширования  
- `python manage_tests.py unit_database` - тесты SQL-слоя

### 12. Интеграционные тесты
**Описание:** Тесты взаимодействия компонентов  
**Что проверяет:** Аутентификация, CRUD операции, API endpoints  
**Запуск:**
- `python manage_tests.py integration_auth` - тесты аутентификации
- `python manage_tests.py integration_crud` - тесты CRUD операций

### 13. Тесты производительности
**Описание:** Тесты производительности с Lighthouse  
**Что проверяет:** Метрики производительности, доступность, SEO, лучшие практики  
**Запуск:** `python manage_tests.py lighthouse`

## Как использовать

### Запуск всех тестов
```bash
python manage_tests.py all
```

### Запуск конкретного теста
```bash
python manage_tests.py <имя_теста>
```

### Просмотр списка тестов
```bash
python manage_tests.py list
```

### Справка
```bash
python manage_tests.py help
```

## Требования

- Сервер должен быть запущен (`uvicorn app.main:app --reload`)
- База данных должна быть инициализирована
- Все зависимости установлены (`pip install -r requirements.txt`)

## Структура тестов

Каждый тест содержит:
- Проверку подключения к серверу
- Тестирование API endpoints
- Проверку UI функциональности
- Валидацию данных
- Проверку безопасности
- Итоговый отчет с результатами

## Результаты

Тесты выводят детальную информацию о каждом этапе проверки:
- ✅ PASS - тест пройден
- ❌ FAIL - тест провален с описанием ошибки

В конце выводится итоговый отчет с количеством пройденных/проваленных тестов.